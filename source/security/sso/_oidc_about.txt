Glossary
^^^^^^^^^^^^^^^^^^^^

* **OIDC** : **O**\ pen\ **ID** **C**\ onnect
* **IDP** : An **Id**\ entity **P**\ rovider is a system entity that creates, maintains, and manages identity information for principals and also provides authentication services to relying applications within a federation or distributed network
* **End-user** : The end user is the entity for whom we are requesting identity information. In our case, it is the |DKU_APP| user that need to login to access |DKU_APP|.
* **OIDC Client** : Also called Relying party **RP** in the OIDC specification, the OIDC client is the application that relies on the IDP to authenticate the end user. In our case, it is |DKU_APP|.
* **ID Token**: Similar to a ID card or passport, it contains many required attributes or claims about the user. This token is then used by |DKU_APP| to map the claims to a corresponding |DKU_APP| user. Digitally signed, the ID token can be verified by the intended recipients (|DKU_APP|).
* **Claim** : In |DKU_APP| context, claims are name/value pairs that contain information about a user.
* **Scope** : In the context of OIDC, scope references a set of claims the OIDC client needs. Example: `email` 
* **Authorization code** : During the OIDC protocol, the authorization code is generated by the IDP and sent to the end-user, which passes it to the OIDC client. It is then used by the OIDC client, who sends the authorization code to the IDP, and receives in exchange an ID token. Using an intermediate authorization code allows the IDP to mandate the OIDC client to authenticate itself in order to retrieve the ID token.
* **Confidential client** : An OIDC client with the capacity to exchange the authorization code for an ID token in a secured back channel. This is the case of |DKU_APP|.
* **Public client** : An OIDC client not able to store secret securely and needs to exchange the authorization code for an ID token in a public channel. |DKU_APP| is not a public client.
* **PKCE** : **P**\ roof **K**\ ey for **C**\ ode **E**\ xchange is an extension of the OIDC protocol, to allow public clients to exchange the authorization code in a public channel. 

Compatibility
^^^^^^^^^^^^^^^^^^^^

|DKU_APP| OIDC integration has been successfully tested against the following OIDC identity providers:

* OKTA
* Azure Active Directory
* Google G.Suite
* Keycloak

OIDC features supported by |DKU_APP|
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* authorization code grant flow
* simple string claims in the ID token
* non encrypted or signed authentication requests
* ID token signed with RSA or EC
* |DKU_APP| behind a proxy 
* response mode supported: `query` or `fragment`
* token endpoint auth method supported: `client secret basic` or `client secret POST`
* confidential OIDC client only (PKCE not supported)

How OIDC looks like with |DKU_APP|
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Once configured for OIDC SSO, |DKU_APP| acts as an OIDC client, which delegates user authentication to an identity provider.

1) When the end user tries to access |DKU_APP| and is not authenticated yet, |DKU_APP| will redirect him to the IDP. The URL used will be the authorization endpoint of the IDP, which some specific GET parameters specific to the |DKU_APP| setup.
2) The IDP will validate the GET parameters and will present a login page to the user. The authentication journey now depends on your IDP capabilities. Sometimes, when already logged-in on the IDP side, the login page is skipped and the user may not see the redirection to the IDP. 
3) The IDP has authenticated the end user and will redirect the user to |DKU_APP| with an authorization code. Depending of your OIDC client setup in your IDP, the code may be passed through via the query parameters or the fragment.
4) The front-end of |DKU_APP| will parse and send the parameters, including the authorization code, to the |DKU_APP| backend. 
5) The |DKU_APP| backend will exchange this authorization code for an access token, by calling the token endpoint with the credentials you previously have configured in |DKU_APP| SSO settings. If successful, the IDP will return an ID token corresponding the end user.
6) |DKU_APP| uses the ID token to map the end user to a |DKU_APP| user. The mapping setup is part of the SSO configuration of OIDC.
7) |DKU_APP| creates a user session corresponding to the |DKU_APP| user. At this point, OIDC is completed and the user session is agnostic of the authentication protocol used.
